function PowermailBackend(s){"use strict";this.initialize=function(){e(),i(),n(),o(),t(),a(),l(),r(),d(),c(),f(),u(),p(),m()};var e=function(){s('*[data-action="openPowermailDetails"]').click(function(){var e=s(this),i=(e.closest("tr").find(".icon:first").toggle(),e.closest("tr").find(".openPowermailDetailsIcons .icon:last"));i.is(":visible")?i.css("display","none"):i.css("display","inline-block"),e.closest("tr").next().toggleClass("powermail_listbe_details_closed").find(".powermail_listbe_details_container").slideToggle()})},i=function(){s(document).on("click",".unhideMail, .hideMail",function(){var e=s(this),i=e.closest("td").find(".container_module_uri").val(),n=e.closest("td").find(".container_uid").val(),o=e.closest("td").find(".container_table").val(),e=h(e.closest("tr"));v(o,n,e,i)})},n=function(){s(document).on("click",'*[data-action="deleteMail"]',function(){var e=s(this),i=e.closest("td").find(".container_module_uri").val(),n=e.closest("td").find(".container_uid").val(),o=e.closest("td").find(".container_table").val(),t=e.closest("td").find(".container_label_delete_confirmation").val();confirm(t)&&(_(e.closest("tr")),w(o,n,i))})},o=function(){s(".powermail_list .pagination a").click(function(e){e.preventDefault();for(var i,n=s(this).prop("href").split("&"),o="",t=0;t<n.length;t++)-1!==n[t].indexOf("widget")&&(o=n[t]);return""!==o&&((e=o.split("="))[0]=e[0].replace("%40","@"),e='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />',(i=s("#powermail_module_search")).append(decodeURI(e)),i.submit()),!1})},t=function(){s("a.sorting").click(function(e){e.preventDefault();for(var i,n=s(this).prop("href").split("&"),o="",t=0;t<n.length;t++)-1!==n[t].indexOf("sorting")&&(o=n[t]);""!==o&&((e=o.split("="))[0]=e[0].replace("%40","@"),(i=s('.extended_export_sorting_container[name="'+decodeURI(e[0])+'"]')).length&&i.remove(),i='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />',(e=s("#powermail_module_search")).append(decodeURI(i)),e.submit())})},a=function(){s(".addPowermailSelection").click(function(){b(s(this)),C()})},l=function(){s(".addPowermailSelectionAll").click(function(){s(".addPowermailSelection").each(function(){b(s(this))}),C()})},r=function(){s(".powermailSelectionDelete").click(function(){g()})},d=function(){s(".powermailSelectionHide").click(function(){y(s)})},c=function(){s("#extended_search input, #extended_search select").not('*[type="submit"]').each(function(){""!==s(this).val()&&s("#extended_search").addClass("in")})},f=function(){s(".export_icon_xls, .export_icon_csv").click(function(){s(this).hasClass("export_icon_csv")&&s("#forwardToAction").val("exportCsv"),s(this).hasClass("export_icon_xls")&&s("#forwardToAction").val("exportXls"),s(this).closest("form").submit()}),s('*[data-action="searchall_submit"]').click(function(){s("#forwardToAction").val("list")}),s(".extended_export_title").click(function(){var e=s(this);e.hasClass("powermail-close")?(e.removeClass("powermail-close").addClass("powermail-open").children("span").removeClass("t3-icon-move-down").addClass("t3-icon-move-up"),e.next().slideDown("",function(){e.next().children("div").children("div").fadeTo("slow",1)})):(e.removeClass("powermail-open").addClass("powermail-close").children("span").removeClass("t3-icon-move-up").addClass("t3-icon-move-down"),e.next().children("div").children("div").fadeTo("slow",0,function(){e.next().slideUp()}))}),s(function(){s(".extended_export_field, .extended_export_field_container").sortable({connectWith:".connected",update:function(e,i){var n;"export_field_selection"===s(this).prop("id")&&(n=s(this).sortable("toArray").toString(),s("#export_fields").val(n))}}).disableSelection()})},u=function(){s(".openHiddenTable").click(function(){var e=s(this).closest("tr");e.find(".dots").toggle(),e.find(".hiddenConverterTable").toggle()})},p=function(){s(".powermail_listbe_details_dd.powermail_listbe_details_type_password").html("********")},m=function(){var e=s(".powermail_reporting_form_fields_table");e.find("tr:even").addClass("even"),e.find("tr:first").removeClass("even"),e.find("tr").hide(),e.find("tr:first").show(),e.find("th").click(function(){var e=s(this);e.hasClass("powermail-close")?e.removeClass("powermail-close").addClass("powermail-open"):e.removeClass("powermail-open").addClass("powermail-close"),e.parent().siblings().slideToggle("fast")}),s('*[data-flot-active="1"]').each(function(){for(var e=s(this),i=[],n=P(e.data("flot-data-values"),","),o=P(e.data("flot-data-labels"),","),t=P(e.data("flot-data-colors"),","),a=0;a<n.length;a++){var l={data:n[a],label:o[a],color:t[a]};i.push(l)}s.plot(e,i,{series:{pie:{show:!0,innerRadius:.5,radius:1,opacity:.3,color:"#FF0000",label:{show:!0,radius:1,formatter:j,background:{opacity:.8}},combine:{color:"#999",threshold:.1}}},grid:{hoverable:!0,clickable:!0}}),e.bind("plothover",function(e,i,n){var o;n&&(o=parseFloat(n.series.percent).toFixed(2),s("#hover").html("<span style='font-weight:bold; color:"+n.series.color+"'>"+n.series.label+" ("+o+"%)</span>"))}),e.bind("plotclick",function(e,i,n){var o;n&&(o=parseFloat(n.series.percent).toFixed(2),alert(n.series.label+": "+o+"%"))})})},h=function(e){var i=e.find(".visibilityButton"),n=0;return i.hasClass("unhideMail")?(i.removeClass("unhideMail").removeClass("fa-toggle-off").addClass("hideMail").addClass("fa-toggle-on"),e.find(".powermailRecordIcon").children(":first").removeClass("hide"),e.find(".powermailRecordIcon").children(":last").addClass("hide")):(i.removeClass("hideMail").removeClass("fa-toggle-on").addClass("unhideMail").addClass("fa-toggle-off"),e.find(".powermailRecordIcon").children().last().removeClass("hide"),e.find(".powermailRecordIcon").children().first().addClass("hide"),n=1),n},v=function(e,i,n,o){s.ajax({url:o+"&data["+e+"]["+i+"][hidden]="+n})},w=function(e,i,n){s.ajax({url:n+"&cmd["+e+"]["+i+"][delete]=1"})},_=function(e){e.fadeOut("slow",function(){e.next().remove(),e.remove()})},b=function(e){(e.hasClass("fa")?e.toggleClass("fa-plus").toggleClass("fa-minus"):e.toggleClass("t3-icon-view-table-expand").toggleClass("t3-icon-view-table-collapse")).closest("tr").toggleClass("selectLine")},C=function(){var e=s(".selectLine").length;s(".selectedLineMessage_numbers").html(e),0<e?s(".selectedLineMessage").show():s(".selectedLineMessage").hide()},g=function(){s(".selectLine").each(function(){var e=s(this),i=e.children(":last"),n=i.find(".container_module_uri").val(),o=i.find(".container_uid").val(),i=i.find(".container_table").val();w(i,o,n),_(e),x(e)}),C()},x=function(e){e=e.find(".addPowermailSelection");b(e)},y=function(){s(".selectLine").each(function(){var e=s(this),i=e.children(":last"),n=i.find(".container_module_uri").val(),o=i.find(".container_uid").val(),i=i.find(".container_table").val();v(i,o,h(e),n),x(e)}),C()},P=function(e,i){i=-1!==e.toString().indexOf(i)?e.split(i):[e];return i},j=function(e,i){return'<div class="flotLabel">'+e+"<br/>"+Math.round(i.percent)+"%</div>"};window.PowermailBackend=PowermailBackend}requirejs.config({map:{"*":{"jquery.flot.min":"TYPO3/CMS/Powermail/Libraries/jquery.flot.min"}},shim:{"TYPO3/CMS/Powermail/Libraries/jquery-ui.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.datetimepicker.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/bootstrap.min":{deps:["jquery"],exports:"jQuery"}}}),define(["jquery","TYPO3/CMS/Powermail/Libraries/jquery-ui.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min","TYPO3/CMS/Powermail/Libraries/bootstrap.min"],function(e){e(document).ready(function(e){new window.PowermailBackend(e).initialize()})});